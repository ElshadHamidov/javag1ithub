<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Checkout - E-commerce</title>
  <script src="https://kit.fontawesome.com/8b8c0b08e2.js" crossorigin="anonymous"></script>
  <link rel="stylesheet" href="checkout.css" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet" />
</head>

<body>
  <div class="top-banner">
    Summer Sale! 50% Off All Items & Free Express Delivery - OFF 50%
    <a href="#">ShopNow</a>
  </div>

  <header>
    <div class="logo">E-commerce</div>
    <nav>
      <a href="./index.html">Home</a>
      <a href="./contact.html">Contact</a>
      <a href="./about.html">About</a>
      <a href="./signup.html">Sign Up</a>
      <a href="./shop.html" class="shop-btn">Shop</a>
    </nav>
    <div class="header-right">
      <input type="text" placeholder="What are you looking for?" class="search-box" />
      <button class="login-btn">Log In</button>
    </div>
  </header>

  <section class="checkout-container">
  <div class="checkout-form">
    <h3>Billing Details</h3>
    <input type="text" id="first-name" placeholder="First Name" />
    <input type="text" id="last-name" placeholder="Last Name" />
    <select id="country">
      <option value="">Select Country</option>
      <option value="US">United States</option>
      <option value="CA">Canada</option>
      <option value="AZ">Azerbaijan</option>
    </select>
    <input type="text" id="city" placeholder="City" />
    <input type="text" id="address" placeholder="Address" />
    <input type="text" id="zip-code" placeholder="Zip" />
    <input type="text" id="phone" placeholder="Tel" />
    <input type="email" id="email" placeholder="Email" />

    <h3>Card Information</h3>
    <input type="text" id="cardholder-name" placeholder="Cardholder Name" />
    <input type="text" id="cart-number" placeholder="Card Number (xxxx xxxx xxxx xxxx)" maxlength="19" />
    <input type="text" id="expiry-Date" placeholder="MM/YY" maxlength="5" />

    <label><input type="checkbox" id="terms" /> Agree to terms and conditions</label>

    <div class="checkout-summary">
      <h3>Cart Total</h3>
      <p>Subtotal: <span id="cart-subtotal">$0.00</span></p>
      <p>Shipping: <strong>FREE</strong></p>
      <p><strong>Total: <span id="cart-total">$0.00</span></strong></p>
      <button class="btn-order" id="place-order">Place order</button>
    </div>
  </section>

  <footer>
    <div class="footer-container">
      <div class="footer-section">
        <h3>Exclusive</h3>
        <p>Get 10% off your first order</p>
        <div class="subscribe">
          <input type="email" placeholder="Enter your email" /><br /><br />
          <button>Subscribe</button>
        </div>
      </div>
      <div class="footer-section">
        <h3>Support</h3>
        <p>111 Bijoy sarani, Dhaka, DH 1515, Bangladesh</p>
        <p>ecommerce@gmail.com</p>
        <p>+88015-88888-9999</p>
      </div>
      <div class="footer-section">
        <h3>Account</h3>
        <a href="./profile.html">My Account</a>
        <a href="./signup.html">Login / Register</a>
        <a href="./cart.html">Cart</a>
        <a href="./order.html">My Order</a>
        <a href="./products.html">My Products</a>
      </div>
      <div class="footer-section">
        <h3>Quick Link</h3>
        <a href="#">Privacy Policy</a>
        <a href="#">Terms Of Use</a>
        <a href="#">FAQ</a>
        <a href="#">Contact</a>
      </div>
      <div class="footer-section">
        <h3>Download App</h3>
        <img src="https://th.bing.com/th/id/OIP.VfrGvim12lMo8DRnHOCTlwHaHU?w=188&h=186&c=7&r=0&o=7&pid=1.7&rm=3"
          alt="App QR" />
        <div class="social-icons">
          <a href="#"><i class="fa-brands fa-facebook"></i></a>
          <a href="#"><i class="fa-brands fa-x-twitter"></i></a>
          <a href="#"><i class="fa-brands fa-instagram"></i></a>
          <a href="#"><i class="fa-brands fa-linkedin"></i></a>
        </div>
      </div>
    </div>
    <div class="footer-bottom">Â© Copyright Remi 2025. All rights reserved.</div>
  </footer>

  <script>
    window.addEventListener("DOMContentLoaded", () => {
      const savedTotal = localStorage.getItem("cartTotal");
      if (savedTotal) {
        document.getElementById("cart-subtotal").innerText = "$" + savedTotal;
        document.getElementById("cart-total").innerText = "$" + savedTotal;
      }

      const placeOrderBtn = document.getElementById("place-order");
      if (placeOrderBtn) {
        placeOrderBtn.addEventListener("click", async () => {
          const token = localStorage.getItem("token"); // get token
          const total = localStorage.getItem("cartTotal") || 0;

          if (!token) {
            alert("You must be logged in to place an order.");
            return;
          }

          const orderData = {
            total: parseFloat(total),
            date: new Date().toISOString(),
            cartNumber: localStorage.getItem("cartNumber"), 
            cartNumber: document.getElementById("cart-number").value,
            expiryDate: document.getElementById("expiry-Date").value,
            address: document.getElementById("address").value,
            city: document.getElementById("city").value,
            zipCode: document.getElementById("zip-code").value,
            country: document.getElementById("country").value,
            phone: document.getElementById("phone").value
          };


          try {
            const response = await fetch("http://localhost:8086/api/orders/add", {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
                "Authorization": `Bearer ${token}`
              },
              body: JSON.stringify(orderData)
            });

            if (response.ok) {
              alert("Order placed successfully!");
              localStorage.removeItem("cartTotal");
              window.location.href = "./order.html";
            } else {
              const errorText = await response.text();
              alert("Failed to place order: " + errorText);
            }
          } catch (err) {
            alert("Error placing order: " + err.message);
          }
        });
      } else {
        console.error("Place Order button not found");
      }
    });

  </script>
</body>

</html>